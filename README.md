## sales-information

このプロジェクトは、マイナビの企業情報・インターン情報を自動で取得し、`mynavi_internships.csv` に一覧として出力するためのツールです。

営業担当の方でも使いやすいように、

- **Electron ベースの GUI アプリ（マイナビ架電リスト収集ツール）**
- それを簡単に起動するための `run.sh`

を用意しています。  
また、検索条件や出力先などの設定は、`mynavi-config.json` というファイルにまとまっており、必要に応じて IT 担当者が編集できます。

---

## 営業向けの使い方

### 事前に IT 担当へ依頼しておいてほしいこと（必須ではないが安心）

- **Node.js（npm, npx を含む）が入っているか確認してもらう**
  - mac の「ターミナル」を開き、`node -v` と入力してバージョンが表示されれば OK です。
  - 入っていない場合でも、`run.sh` を実行すると **自動で Node.js のインストールを試みます**（Homebrew 利用）。  
    うまくいかない場合だけ、IT 担当の方にインストールを依頼してください。
  - マイナビ側で **アクセス制限（頻繁なアクセスによるブロックなど）が行われる可能性** があるため、  
    可能であれば **外部の VPN サービス経由** など、通常とは異なる回線を経由してアクセスすることも検討してください。  
    ※ VPN の利用可否や利用ルールについては、必ず所属組織の情報セキュリティポリシーに従ってください。
  - また、マイナビ側への負荷やアカウントへの制限リスクを下げるため、  
    **1 日あたりに取得する企業数はおおよそ 100 件以内** を目安とし、  
    それ以上の件数が必要な場合は、**日を分けて複数回に分割して実行** することを推奨します。

### 1. フォルダを用意する（パスは気にしなくて OK）

1. このツールのフォルダ（`sales-information`）を、分かりやすい場所（デスクトップなど）に置いてください。
2. Finder で `sales-information` フォルダを開きます。

※ 「パス」や「/Users/〜」などの文字列は気にしなくて大丈夫です。

### 2. スクリプトを実行する（ドラッグ＆ドロップで OK）

1. mac の「ターミナル」を開きます。  
   - 画面右上の虫めがねマーク（Spotlight）で「ターミナル」と入力して開くと便利です。
2. 開いたターミナルの黒い画面に、Finder で開いている `sales-information` フォルダを **ドラッグ＆ドロップ** します。
3. キーボードで `cd` と入力してから、半角スペースを 1 つ入れて、そこにフォルダをドラッグ＆ドロップしても OK です。
4. 画面に

```bash
cd （何か長い文字列）
```

   のように表示されたら、Enter キーを押します。
5. 次のコマンドを順番に入力（またはコピー & ペースト）して、Enter を押します。

```bash
chmod +x run.sh   # 初回だけでOK
./run.sh
```

### 3. GUI での操作

`./run.sh` を実行すると、自動で必要なライブラリがインストールされ、その後 **「マイナビ架電リスト収集ツール」ウィンドウ** が開きます。

ウィンドウでは、主に次のように操作します。

- **スクレイピング開始** ボタン  
  - Playwright + Chromium でマイナビのブラウザを開き、スクレイピング処理を開始します。
- **ログイン完了（Enter 送信）** ボタン  
  - マイナビにログインし終わったら押します。  
  - 従来ターミナルに向かって Enter を押していたのと同じ意味で、スクレイピング処理の続きが進みます。
- **停止** ボタン  
  - スクレイピング中の処理を安全に止めたいときに押します。

右側には `mynavi-config.json` の内容が表示されており、必要に応じて IT 担当者が編集できます。

### 4. 結果の確認

- 処理が完了すると、`sales-information` フォルダの中にある **`mynavi_internships.csv`** に結果が保存されます。
- すでにファイルがある場合は、同じ場所のファイルが上書き・追記されます。
- `mynavi_internships.csv` は Excel などで開くことができます。

---

## 設定ファイル（`mynavi-config.json`）について

通常、**営業担当の方がこのファイルを直接編集する必要はありません。**  
検索条件の変更やスプレッドシートとの連携方法を変えたい場合は、IT 担当者にこのセクションを共有してください。

`mynavi-config.json` の中身は、以下のようになっています。

```json
{
  "SEARCH_URL": "https://job.mynavi.jp/27/pc/corpinfo/searchCorpListByGenCond/index/?cond=HR:13,14,25,26,27,28,29,30/ER:1",
  "START_PAGE": 1,
  "SPREADSHEET_URL": "https://docs.google.com/spreadsheets/........../edit",
  "CSV_PATH": "mynavi_internships.csv",
  "GAS_UPLOAD_URL": "https://script.google.com/macros/s/........../exec",
  "GAS_UPLOAD_TOKEN": "change-me"
}
```

- **SEARCH_URL**:  
  マイナビの検索画面の URL です。  
  - ここに含まれる `HR:13,14,25,...` の部分が **業種や条件の指定** になっています。  
  - 検索条件を変えたい場合は、マイナビの画面で条件を指定 → 表示された検索結果ページの URL をコピーして、ここに貼り付けます。

- **START_PAGE**:  
  何ページ目からスクレイピングを開始するかを示します。  
  - 通常は `1` のままで問題ありません。  
  - 途中から再開したい場合だけ、開始したいページ番号に変更します。

- **SPREADSHEET_URL**:  
  連携先の **Google スプレッドシートの URL** です。  
  - 営業チームで共有しているスプレッドシートの URL を指定します。  
  - スプレッドシート連携を使わない場合でも、設定されていて問題ありません（ツール側で利用する場合のみ参照されます）。

- **CSV_PATH**:  
  出力する CSV ファイルの名前（パス）です。  
  - 標準では `mynavi_internships.csv` になっています。  
  - 別名のファイルにしたい場合は、ここを例えば `mynavi_internships_2025.csv` などに変更します。

- **GAS_UPLOAD_URL**:  
  データを Google スプレッドシートにアップロードするための **Google Apps Script（GAS）の Web アプリ URL** です。  
  - スプレッドシート連携を使う場合に設定します。  
  - 使わない場合は、そのままでも問題ありません（スクリプト側でアップロードを呼ばなければ何も起きません）。

- **GAS_UPLOAD_TOKEN**:  
  GAS 側で簡易認証をするための **トークン文字列** です。  
  - 初期値は `"change-me"` になっているので、実運用時は GAS 側と合わせて任意の長めの文字列に変更してください。

### Google スプレッドシート連携（`gasscript.js` の設定）

このツールは、オプションで **Google スプレッドシートに 1 行ずつデータを送る** ことができます。  
そのために、スプレッドシート側に **Google Apps Script（GAS）を 1 つ作成しておく必要** があります。

#### IT 担当者向け手順

1. マイナビの結果を保存したい **Google スプレッドシートを開く**  
2. メニューから **「拡張機能」 → 「Apps Script」** を開く  
3. そこで新しいプロジェクトが開いたら、デフォルトである `Code.gs` などの中身をすべて削除し、  
   このリポジトリの `gasscript.js` の内容を **そのままコピペ** してください。
4. スクリプト内の以下の部分を、環境に合わせて修正します。

```javascript
const AUTH_TOKEN = 'change-me'; // トークン(漏洩しないように)
const SHEET_ID = SpreadsheetApp.getActiveSpreadsheet().getId();
const SHEET_NAME = 'シート1'; // 実際のシート名に変更
```

- **AUTH_TOKEN**  
  - 任意の長めの文字列に変更してください（例: `'my-secret-token-2025-XXXX'` など）。  
  - この値を、`mynavi-config.json` の `GAS_UPLOAD_TOKEN` にも同じ文字列で設定します。
- **SHEET_ID**  
  - `SpreadsheetApp.getActiveSpreadsheet().getId();` のままで問題ありません。  
  - 現在開いているスプレッドシートを自動的に対象にします。
- **SHEET_NAME**  
  - 実際にデータを書き込みたいシート名に変更してください（例: `'インターン一覧'` など）。

5. Apps Script の画面右上あたりの「デプロイ」ボタンから、  
   **「新しいデプロイ」 → 種類を Web アプリ** に設定します。
   - 実行するユーザー: 「自分」  
   - アクセスできるユーザー: 「全員（匿名ユーザーを含む）」 など、要件に合わせて設定してください。
6. デプロイ後に表示される **Web アプリの URL** をコピーし、  
   `mynavi-config.json` の `GAS_UPLOAD_URL` に貼り付けます。

こうしておくと、ツール側から GAS に対して  
`X-Auth-Token` ヘッダに `GAS_UPLOAD_TOKEN` を乗せて POST し、1 行ずつスプレッドシートに追記できるようになります。

### 営業担当の方向けまとめ

- **ふだんは `mynavi-config.json` を触る必要はありません。**
- 検索条件（業種など）や出力先スプレッドシートを変えたいときだけ、  
  - 「この README の『設定ファイル（mynavi-config.json）について』のところを見て設定を変えてください」  
    と IT 担当の方に依頼してください。

---

## 補足（技術者向け）

- 依存パッケージ
  - TypeScript / ts-node
  - Playwright（Chromium）
- 通常の開発用コマンド

```bash
npm install
npx playwright install chromium
npm run scrape:mynavi
```

